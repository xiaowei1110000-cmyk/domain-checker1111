<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤šç¾¤ç½‘ç«™ç›‘æ§ç³»ç»Ÿ v10.0 - å®Œæ•´ç‰ˆ</title>
    <style>
        /* ===== å…¨å±€æ ·å¼é‡ç½® ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --success-gradient: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
            --warning-gradient: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
            --danger-gradient: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            --info-gradient: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            --telegram-gradient: linear-gradient(135deg, #0088cc 0%, #006699 100%);
            
            --primary-color: #667eea;
            --success-color: #2ecc71;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --info-color: #3498db;
            --light-color: #f8f9fa;
            --dark-color: #2c3e50;
            --border-color: #e9ecef;
            --text-primary: #2c3e50;
            --text-secondary: #6c757d;
            
            --shadow-sm: 0 2px 4px rgba(0,0,0,0.05);
            --shadow-md: 0 4px 12px rgba(0,0,0,0.08);
            --shadow-lg: 0 10px 30px rgba(0,0,0,0.12);
            --shadow-xl: 0 20px 60px rgba(0,0,0,0.15);
            
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --radius-xl: 20px;
            
            --transition-normal: 0.3s ease;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 20px;
            color: var(--text-primary);
        }
        
        .container {
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-xl);
            padding: 30px;
            position: relative;
            overflow: hidden;
        }
        
        .container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 6px;
            background: var(--primary-gradient);
        }
        
        /* ===== å¤´éƒ¨æ ·å¼ ===== */
        header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--border-color);
            position: relative;
        }
        
        header::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 4px;
            background: var(--primary-gradient);
            border-radius: 2px;
        }
        
        h1 {
            color: transparent;
            margin-bottom: 10px;
            font-size: 2.2rem;
            font-weight: 800;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            background-clip: text;
        }
        
        .subtitle {
            color: var(--text-secondary);
            font-size: 1rem;
        }
        
        /* ===== å¸ƒå±€ ===== */
        .main-layout {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        @media (max-width: 1200px) {
            .main-layout {
                grid-template-columns: 1fr;
            }
        }
        
        /* ===== ç¾¤ç»„é…ç½® ===== */
        .group-config {
            background: white;
            border-radius: var(--radius-lg);
            padding: 25px;
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--border-color);
            height: fit-content;
            position: sticky;
            top: 30px;
        }
        
        .group-config::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: var(--telegram-gradient);
            border-radius: var(--radius-lg) var(--radius-lg) 0 0;
        }
        
        .group-config h3 {
            color: var(--dark-color);
            margin-bottom: 20px;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .group-list {
            max-height: 400px;
            overflow-y: auto;
            margin-bottom: 20px;
        }
        
        .group-item {
            background: var(--light-color);
            border-radius: var(--radius-md);
            padding: 15px;
            margin-bottom: 10px;
            border: 1px solid var(--border-color);
            transition: var(--transition-normal);
            cursor: pointer;
        }
        
        .group-item:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-sm);
            background: #e8f4fc;
        }
        
        .group-item.active {
            background: linear-gradient(135deg, rgba(52, 152, 219, 0.1) 0%, rgba(41, 128, 185, 0.1) 100%);
            border-color: var(--info-color);
        }
        
        .group-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .group-name {
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .group-buttons {
            display: flex;
            gap: 6px;
        }
        
        .group-btn {
            padding: 4px 8px;
            border: none;
            border-radius: var(--radius-sm);
            font-size: 0.8rem;
            cursor: pointer;
            background: var(--info-color);
            color: white;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .group-btn.delete {
            background: var(--danger-color);
        }
        
        .group-btn.edit {
            background: var(--warning-color);
        }
        
        .group-details {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }
        
        .group-details div {
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        /* ===== è¡¨å•å…ƒç´  ===== */
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        input, textarea, select {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border-color);
            border-radius: var(--radius-md);
            font-size: 0.95rem;
            background: var(--light-color);
            transition: var(--transition-normal);
        }
        
        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: var(--primary-color);
            background: white;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        textarea {
            height: 150px;
            resize: vertical;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            line-height: 1.5;
        }
        
        /* ===== æŒ‰é’®æ ·å¼ ===== */
        .buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: var(--radius-md);
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition-normal);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        
        .btn-success {
            background: var(--success-gradient);
            color: white;
        }
        
        .btn-telegram {
            background: var(--telegram-gradient);
            color: white;
        }
        
        .btn-warning {
            background: var(--warning-gradient);
            color: white;
        }
        
        .btn-danger {
            background: var(--danger-gradient);
            color: white;
        }
        
        .btn-info {
            background: var(--info-gradient);
            color: white;
        }
        
        .btn-secondary {
            background: var(--light-color);
            color: var(--text-primary);
            border: 2px solid var(--border-color);
        }
        
        /* ===== é…ç½®åŒºåŸŸ ===== */
        .config-section {
            background: linear-gradient(135deg, rgba(212, 237, 218, 0.1) 0%, rgba(195, 230, 203, 0.1) 100%);
            border: 1px solid rgba(40, 167, 69, 0.15);
            padding: 20px;
            margin-bottom: 20px;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
        }
        
        .config-section h3 {
            color: var(--success-color);
            margin-bottom: 15px;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .input-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            align-items: end;
        }
        
        /* ===== ç›‘æ§çŠ¶æ€ ===== */
        .monitor-status {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .status-card {
            background: white;
            padding: 20px;
            border-radius: var(--radius-lg);
            text-align: center;
            box-shadow: var(--shadow-md);
            border-top: 5px solid var(--info-color);
            transition: var(--transition-normal);
        }
        
        .status-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }
        
        .status-card.warning { border-top-color: var(--warning-color); }
        .status-card.danger { border-top-color: var(--danger-color); }
        .status-card.success { border-top-color: var(--success-color); }
        .status-card.telegram { border-top-color: #0088cc; }
        
        .status-number {
            font-size: 1.8rem;
            font-weight: 800;
            color: var(--text-primary);
            margin: 10px 0;
        }
        
        .status-title {
            font-size: 0.85rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
        }
        
        /* ===== åŸŸååˆ—è¡¨ ===== */
        .domain-list {
            margin: 15px 0;
            padding: 15px;
            background: white;
            border-radius: var(--radius-lg);
            max-height: 300px;
            overflow-y: auto;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border-color);
            display: none;
        }
        
        .domain-item {
            padding: 12px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .domain-item:last-child {
            border-bottom: none;
        }
        
        .domain-name {
            flex: 1;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
        }
        
        .domain-status {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            min-width: 100px;
            text-align: center;
        }
        
        .status-pending { background: #f8f9fa; color: #6c757d; }
        .status-testing { background: #e3f2fd; color: #1976d2; animation: pulse 1.5s infinite; }
        .status-success { background: #e8f5e8; color: #2e7d32; }
        .status-error { background: #ffebee; color: #c62828; }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }
        
        /* ===== æµ‹è¯•æ§åˆ¶ ===== */
        .test-controls {
            background: linear-gradient(135deg, #f8fdff 0%, #e8f4fc 100%);
            padding: 20px;
            border-radius: var(--radius-lg);
            margin: 20px 0;
            border: 1px solid rgba(52, 152, 219, 0.2);
            box-shadow: var(--shadow-md);
            display: none;
        }
        
        .test-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stat-item {
            background: white;
            padding: 12px;
            border-radius: var(--radius-md);
            text-align: center;
        }
        
        .stat-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-bottom: 5px;
        }
        
        .stat-value {
            font-size: 1.2rem;
            font-weight: bold;
        }
        
        .progress-container {
            margin: 20px 0;
        }
        
        .progress-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-weight: 600;
        }
        
        .progress-bar {
            height: 10px;
            background: var(--light-color);
            border-radius: 5px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: var(--success-gradient);
            width: 0%;
            transition: width 0.5s ease;
        }
        
        /* ===== ç›‘æ§æ—¥å¿— ===== */
        .monitor-log {
            background: var(--dark-color);
            padding: 15px;
            border-radius: var(--radius-lg);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            color: #e9ecef;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 20px;
        }
        
        .log-entry {
            padding: 8px 0;
            border-bottom: 1px solid #34495e;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .log-entry:last-child {
            border-bottom: none;
        }
        
        .log-time {
            color: #adb5bd;
            font-size: 0.8rem;
            min-width: 60px;
        }
        
        /* ===== çŠ¶æ€æ¶ˆæ¯ ===== */
        .status-message {
            margin-top: 10px;
            padding: 10px 15px;
            border-radius: var(--radius-md);
            display: none;
            font-weight: 500;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .status-success {
            background: rgba(212, 237, 218, 0.9);
            color: #155724;
            border-left: 5px solid var(--success-color);
        }
        
        .status-error {
            background: rgba(248, 215, 218, 0.9);
            color: #721c24;
            border-left: 5px solid var(--danger-color);
        }
        
        /* ===== é¡µè„š ===== */
        footer {
            margin-top: 30px;
            text-align: center;
            color: var(--text-secondary);
            font-size: 0.85rem;
            padding: 15px;
            border-top: 1px solid var(--border-color);
        }
        
        /* ===== å“åº”å¼è®¾è®¡ ===== */
        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }
            
            h1 {
                font-size: 1.8rem;
            }
            
            .main-layout {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .group-config {
                position: static;
            }
            
            .buttons {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
        }
        
        /* ===== æ»šåŠ¨æ¡ç¾åŒ– ===== */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }
        
        .monitor-log::-webkit-scrollbar-track {
            background: #2c3e50;
        }
        
        .monitor-log::-webkit-scrollbar-thumb {
            background: #4a6572;
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-broadcast-tower"></i> å¤šç¾¤ç½‘ç«™ç›‘æ§ç³»ç»Ÿ v10.0</h1>
            <p class="subtitle">æ”¯æŒå¤šç¾¤ç›‘æ§ | ä¸€é”®æˆªå›¾å‘é€ | è¿è¥å•†èŠ‚ç‚¹åˆ†æ | å³æ—¶é€šçŸ¥</p>
        </header>
        
        <div class="main-layout">
            <div class="main-content">
                <!-- è¯´æ˜åŒºåŸŸ -->
                <div class="config-section">
                    <h3><i class="fas fa-info-circle"></i> ä½¿ç”¨è¯´æ˜</h3>
                    <p>1. åœ¨å³ä¾§æ·»åŠ ç¾¤ç»„é…ç½®ï¼ˆæ¯ä¸ªç¾¤ç‹¬ç«‹çš„Botå’Œæµ‹è¯•é“¾æ¥ï¼‰</p>
                    <p>2. ç³»ç»Ÿä¼šè‡ªåŠ¨ä¸ºæ¯ä¸ªé“¾æ¥æ‰“å¼€ITDOGé¡µé¢æµ‹è¯•</p>
                    <p>3. <strong>æµ‹è¯•å®Œæˆç«‹å³å‘é€æˆªå›¾å’Œç»“æœ</strong>åˆ°å¯¹åº”ç¾¤ç»„ï¼ˆä¸åªæ˜¯å¼‚å¸¸ï¼‰</p>
                    <p>4. å¼‚å¸¸æ—¶ä¼š@ç¾¤ç»„ä¸­æŒ‡å®šçš„ç”¨æˆ·ï¼ˆå¤šä¸ªç”¨æˆ·ç”¨é€—å·åˆ†éš”ï¼‰</p>
                    <p>5. æ”¯æŒè¿è¥å•†èŠ‚ç‚¹åˆ†æï¼ŒåŒºåˆ†ç§»åŠ¨/è”é€š/ç”µä¿¡å¼‚å¸¸</p>
                    <p>6. <strong style="color: #e74c3c;">è¯·å…ˆå®‰è£…Tampermonkeyè„šæœ¬ï¼ˆä¸‹æ–¹æŒ‰é’®è·å–ï¼‰</strong></p>
                </div>
                
                <!-- è„šæœ¬å®‰è£… -->
                <div class="config-section">
                    <h3><i class="fas fa-code"></i> Tampermonkeyè„šæœ¬å®‰è£…</h3>
                    <div class="buttons">
                        <button class="btn btn-info" id="install-script-btn">
                            <i class="fas fa-download"></i> è·å–ç›‘æ§è„šæœ¬
                        </button>
                        <button class="btn btn-warning" id="test-script-btn">
                            <i class="fas fa-vial"></i> æµ‹è¯•è„šæœ¬è¿æ¥
                        </button>
                    </div>
                    <div id="script-status" style="margin-top: 10px; display: none;"></div>
                </div>
                
                <!-- ç›‘æ§çŠ¶æ€ -->
                <div class="monitor-status" id="monitor-status">
                    <div class="status-card">
                        <div class="status-title">æ´»è·ƒç¾¤ç»„</div>
                        <div class="status-number" id="active-groups-count">0</div>
                    </div>
                    <div class="status-card warning">
                        <div class="status-title">ä»Šæ—¥æµ‹è¯•</div>
                        <div class="status-number" id="today-tests">0</div>
                    </div>
                    <div class="status-card telegram">
                        <div class="status-title">å‘é€é€šçŸ¥</div>
                        <div class="status-number" id="sent-notifications">0</div>
                    </div>
                    <div class="status-card">
                        <div class="status-title">æ€»é“¾æ¥æ•°</div>
                        <div class="status-number" id="total-domains">0</div>
                    </div>
                </div>
                
                <!-- æ‰¹é‡æµ‹è¯• -->
                <div class="config-section">
                    <h3><i class="fas fa-globe"></i> æ‰¹é‡æµ‹è¯•æ§åˆ¶</h3>
                    
                    <div class="buttons">
                        <button class="btn btn-success" id="start-all-btn">
                            <i class="fas fa-play"></i> å¯åŠ¨æ‰€æœ‰ç¾¤ç»„
                        </button>
                        <button class="btn btn-warning" id="start-selected-btn">
                            <i class="fas fa-bolt"></i> å¯åŠ¨é€‰ä¸­ç¾¤ç»„
                        </button>
                        <button class="btn btn-danger" id="stop-all-btn">
                            <i class="fas fa-stop"></i> åœæ­¢æ‰€æœ‰æµ‹è¯•
                        </button>
                        <button class="btn btn-info" id="test-now-btn">
                            <i class="fas fa-rocket"></i> ç«‹å³æµ‹è¯•ä¸€æ¬¡
                        </button>
                    </div>
                    
                    <!-- æµ‹è¯•è¿›åº¦ -->
                    <div class="test-controls" id="test-controls">
                        <div class="test-stats">
                            <div class="stat-item">
                                <div class="stat-label">è¿›è¡Œä¸­</div>
                                <div class="stat-value" id="active-tests">0</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">å·²æµ‹è¯•</div>
                                <div class="stat-value" id="tested-count">0</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">æˆåŠŸ</div>
                                <div class="stat-value" id="success-count">0</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">å¼‚å¸¸</div>
                                <div class="stat-value" id="error-count">0</div>
                            </div>
                        </div>
                        
                        <div class="progress-container">
                            <div class="progress-info">
                                <span>æµ‹è¯•è¿›åº¦</span>
                                <span id="progress-text">0/0</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="progress-bar"></div>
                            </div>
                        </div>
                        
                        <div class="buttons">
                            <button class="btn btn-warning" id="pause-btn">
                                <i class="fas fa-pause"></i> æš‚åœ
                            </button>
                            <button class="btn btn-danger" id="stop-btn">
                                <i class="fas fa-stop"></i> åœæ­¢
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- ç›‘æ§æ—¥å¿— -->
                <div class="config-section">
                    <h3><i class="fas fa-clipboard-list"></i> ç›‘æ§æ—¥å¿—</h3>
                    <div class="monitor-log" id="monitor-log">
                        <div class="log-entry">
                            <span class="log-time">å°±ç»ª</span>
                            <span class="log-content">ğŸ‰ å¤šç¾¤ç›‘æ§ç³»ç»Ÿ v10.0 å·²å¯åŠ¨ - æ”¯æŒæˆªå›¾å’Œç»“æœå‘é€</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ç¾¤ç»„é…ç½® -->
            <div class="group-config">
                <h3><i class="fab fa-telegram"></i> ç¾¤ç»„é…ç½®ç®¡ç†</h3>
                
                <div class="form-group">
                    <label for="group-name">ç¾¤ç»„åç§°</label>
                    <input type="text" id="group-name" placeholder="ä¾‹å¦‚ï¼šä¸»ç›‘æ§ç¾¤">
                </div>
                
                <div class="form-group">
                    <label for="bot-token">Bot Token</label>
                    <input type="text" id="bot-token" placeholder="è¾“å…¥Telegram Bot Token">
                </div>
                
                <div class="form-group">
                    <label for="chat-id">Chat ID</label>
                    <input type="text" id="chat-id" placeholder="è¾“å…¥ç¾¤ç»„Chat ID">
                </div>
                
                <div class="form-group">
                    <label for="mention-users">å¼‚å¸¸æ—¶@çš„ç”¨æˆ·ID</label>
                    <input type="text" id="mention-users" placeholder="ä¾‹å¦‚ï¼š123456,789012ï¼ˆé€—å·åˆ†éš”ï¼‰">
                </div>
                
                <div class="form-group">
                    <label for="connectivity-threshold">è¿é€šç‡é˜ˆå€¼ (%)</label>
                    <input type="number" id="connectivity-threshold" min="1" max="100" value="90" placeholder="ä½äºæ­¤å€¼å‘é€å¼‚å¸¸é€šçŸ¥">
                </div>
                
                <div class="form-group">
                    <label for="group-domains">æµ‹è¯•é“¾æ¥ï¼ˆæ¯è¡Œä¸€ä¸ªï¼‰</label>
                    <textarea id="group-domains" placeholder="https://example.com&#10;http://test.com/path&#10;www.domain.com"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="test-interval">æµ‹è¯•é—´éš”ï¼ˆåˆ†é’Ÿï¼‰</label>
                    <input type="number" id="test-interval" min="1" value="60">
                </div>
                
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="send-screenshot" checked> 
                        å‘é€æµ‹è¯•ç»“æœæˆªå›¾
                    </label>
                </div>
                
                <div class="buttons">
                    <button class="btn btn-telegram" id="save-group-btn">
                        <i class="fas fa-save"></i> ä¿å­˜ç¾¤ç»„
                    </button>
                    <button class="btn btn-secondary" id="clear-form-btn">
                        <i class="fas fa-times"></i> æ¸…ç©º
                    </button>
                    <button class="btn btn-danger" id="delete-group-btn" style="display: none;">
                        <i class="fas fa-trash"></i> åˆ é™¤ç¾¤ç»„
                    </button>
                </div>
                
                <div id="config-status" class="status-message"></div>
                
                <!-- ç¾¤ç»„åˆ—è¡¨ -->
                <div class="group-list" id="group-list">
                    <!-- ç¾¤ç»„é¡¹ç›®ä¼šåŠ¨æ€æ·»åŠ åˆ°è¿™é‡Œ -->
                </div>
            </div>
        </div>
        
        <footer>
            <p>å¤šç¾¤ç½‘ç«™ç›‘æ§ç³»ç»Ÿ v10.0 | ä¸Tampermonkeyè„šæœ¬é…åˆä½¿ç”¨ | æˆªå›¾å‘é€ç‰ˆ</p>
            <p>è¯·ç¡®ä¿å·²å®‰è£… Tampermonkey æ‰©å±•å¹¶åŠ è½½ç›‘æ§è„šæœ¬</p>
        </footer>
    </div>

<script>
// ============================================
// å¤šç¾¤ç½‘ç«™ç›‘æ§ç³»ç»Ÿ v10.0 - å®Œæ•´ç‰ˆ
// ============================================
document.addEventListener('DOMContentLoaded', function() {
    // å…ƒç´ å¼•ç”¨
    const elements = {
        // ç¾¤ç»„é…ç½®å…ƒç´ 
        groupName: document.getElementById('group-name'),
        botToken: document.getElementById('bot-token'),
        chatId: document.getElementById('chat-id'),
        mentionUsers: document.getElementById('mention-users'),
        connectivityThreshold: document.getElementById('connectivity-threshold'),
        groupDomains: document.getElementById('group-domains'),
        testInterval: document.getElementById('test-interval'),
        sendScreenshot: document.getElementById('send-screenshot'),
        saveGroupBtn: document.getElementById('save-group-btn'),
        clearFormBtn: document.getElementById('clear-form-btn'),
        deleteGroupBtn: document.getElementById('delete-group-btn'),
        groupList: document.getElementById('group-list'),
        configStatus: document.getElementById('config-status'),
        
        // è„šæœ¬æ§åˆ¶å…ƒç´ 
        installScriptBtn: document.getElementById('install-script-btn'),
        testScriptBtn: document.getElementById('test-script-btn'),
        scriptStatus: document.getElementById('script-status'),
        
        // æµ‹è¯•æ§åˆ¶å…ƒç´ 
        startAllBtn: document.getElementById('start-all-btn'),
        startSelectedBtn: document.getElementById('start-selected-btn'),
        stopAllBtn: document.getElementById('stop-all-btn'),
        testNowBtn: document.getElementById('test-now-btn'),
        testControls: document.getElementById('test-controls'),
        pauseBtn: document.getElementById('pause-btn'),
        stopBtn: document.getElementById('stop-btn'),
        activeTests: document.getElementById('active-tests'),
        testedCount: document.getElementById('tested-count'),
        successCount: document.getElementById('success-count'),
        errorCount: document.getElementById('error-count'),
        progressText: document.getElementById('progress-text'),
        progressBar: document.getElementById('progress-bar'),
        
        // çŠ¶æ€æ˜¾ç¤ºå…ƒç´ 
        activeGroupsCount: document.getElementById('active-groups-count'),
        todayTests: document.getElementById('today-tests'),
        sentNotifications: document.getElementById('sent-notifications'),
        totalDomains: document.getElementById('total-domains'),
        
        // ç›‘æ§æ—¥å¿—å…ƒç´ 
        monitorLog: document.getElementById('monitor-log')
    };

    // çŠ¶æ€å˜é‡
    let groups = {};
    let activeTestGroups = new Map(); // groupId -> test state
    let selectedGroupId = null;
    let isTesting = false;
    let isPaused = false;
    let stats = {
        todayTests: 0,
        sentNotifications: 0,
        totalDomains: 0,
        lastReset: new Date().toDateString()
    };

    // æˆªå›¾ç¼“å­˜
    const screenshotCache = new Map();

    // åˆå§‹åŒ–
    function init() {
        loadGroups();
        loadStats();
        setupEventListeners();
        updateGroupList();
        updateStatsDisplay();
        
        // ç›‘å¬æ¥è‡ªITDOGé¡µé¢çš„æ¶ˆæ¯
        window.addEventListener('message', handleITDOGMessage);
        
        addLog('ğŸ‰ å¤šç¾¤ç›‘æ§ç³»ç»Ÿ v10.0 å·²å¯åŠ¨', 'success');
        addLog('ğŸ“¸ æµ‹è¯•å®Œæˆåä¼šè‡ªåŠ¨æˆªå›¾å¹¶å‘é€åˆ°Telegramç¾¤ç»„', 'info');
        addLog('ğŸ‘¥ æ”¯æŒå¤šç¾¤ç‹¬ç«‹é…ç½®å’Œç›‘æ§', 'info');
        
        // æ£€æŸ¥æ˜¯å¦éœ€è¦é‡ç½®æ¯æ—¥ç»Ÿè®¡
        checkDailyReset();
        
        // æ£€æŸ¥è„šæœ¬æ˜¯å¦å·²å®‰è£…
        setTimeout(checkTampermonkey, 2000);
    }

    // æ£€æŸ¥Tampermonkeyè„šæœ¬
    function checkTampermonkey() {
        // å‘é€æµ‹è¯•æ¶ˆæ¯æ£€æŸ¥è„šæœ¬æ˜¯å¦è¿è¡Œ
        window.postMessage({ 
            type: 'PING_ITDOG_MONITOR',
            source: 'MAIN_CONTROL',
            timestamp: Date.now()
        }, '*');
        
        setTimeout(() => {
            if (!window.itdogMonitorDetected) {
                showScriptStatus('âš ï¸ Tampermonkeyè„šæœ¬æœªæ£€æµ‹åˆ°ï¼Œè¯·å®‰è£…è„šæœ¬', 'warning');
            } else {
                showScriptStatus('âœ… Tampermonkeyè„šæœ¬å·²æ£€æµ‹åˆ°', 'success');
            }
        }, 1000);
    }

    // æ˜¾ç¤ºè„šæœ¬çŠ¶æ€
    function showScriptStatus(message, type) {
        elements.scriptStatus.textContent = message;
        elements.scriptStatus.style.display = 'block';
        elements.scriptStatus.style.padding = '10px';
        elements.scriptStatus.style.borderRadius = '8px';
        elements.scriptStatus.style.marginTop = '10px';
        elements.scriptStatus.style.fontSize = '14px';
        
        if (type === 'success') {
            elements.scriptStatus.style.background = 'rgba(46, 204, 113, 0.1)';
            elements.scriptStatus.style.color = '#155724';
            elements.scriptStatus.style.borderLeft = '4px solid #2ecc71';
        } else if (type === 'warning') {
            elements.scriptStatus.style.background = 'rgba(243, 156, 18, 0.1)';
            elements.scriptStatus.style.color = '#856404';
            elements.scriptStatus.style.borderLeft = '4px solid #f39c12';
        } else if (type === 'error') {
            elements.scriptStatus.style.background = 'rgba(231, 76, 60, 0.1)';
            elements.scriptStatus.style.color = '#721c24';
            elements.scriptStatus.style.borderLeft = '4px solid #e74c3c';
        }
    }

    // åŠ è½½ç¾¤ç»„é…ç½®
    function loadGroups() {
        try {
            const savedGroups = localStorage.getItem('monitor_groups_v10');
            if (savedGroups) {
                groups = JSON.parse(savedGroups);
                updateTotalDomains();
            }
        } catch (error) {
            console.error('åŠ è½½ç¾¤ç»„é…ç½®å¤±è´¥:', error);
            addLog('âŒ åŠ è½½ç¾¤ç»„é…ç½®å¤±è´¥', 'error');
        }
    }

    // ä¿å­˜ç¾¤ç»„é…ç½®
    function saveGroups() {
        try {
            localStorage.setItem('monitor_groups_v10', JSON.stringify(groups));
            updateTotalDomains();
            return true;
        } catch (error) {
            console.error('ä¿å­˜ç¾¤ç»„é…ç½®å¤±è´¥:', error);
            addLog('âŒ ä¿å­˜ç¾¤ç»„é…ç½®å¤±è´¥', 'error');
            return false;
        }
    }

    // åŠ è½½ç»Ÿè®¡æ•°æ®
    function loadStats() {
        try {
            const savedStats = localStorage.getItem('monitor_stats_v10');
            if (savedStats) {
                const loadedStats = JSON.parse(savedStats);
                if (loadedStats.lastReset === new Date().toDateString()) {
                    stats = loadedStats;
                } else {
                    resetDailyStats();
                }
            }
        } catch (error) {
            console.error('åŠ è½½ç»Ÿè®¡æ•°æ®å¤±è´¥:', error);
        }
    }

    // ä¿å­˜ç»Ÿè®¡æ•°æ®
    function saveStats() {
        try {
            localStorage.setItem('monitor_stats_v10', JSON.stringify(stats));
        } catch (error) {
            console.error('ä¿å­˜ç»Ÿè®¡æ•°æ®å¤±è´¥:', error);
        }
    }

    // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
    function setupEventListeners() {
        // ä¿å­˜ç¾¤ç»„
        elements.saveGroupBtn.addEventListener('click', saveGroup);
        elements.clearFormBtn.addEventListener('click', clearForm);
        elements.deleteGroupBtn.addEventListener('click', deleteGroup);
        
        // è„šæœ¬æ§åˆ¶
        elements.installScriptBtn.addEventListener('click', showScriptCode);
        elements.testScriptBtn.addEventListener('click', testScriptConnection);
        
        // æµ‹è¯•æ§åˆ¶
        elements.startAllBtn.addEventListener('click', startAllGroups);
        elements.startSelectedBtn.addEventListener('click', startSelectedGroup);
        elements.stopAllBtn.addEventListener('click', stopAllGroups);
        elements.testNowBtn.addEventListener('click', testSelectedGroupOnce);
        elements.pauseBtn.addEventListener('click', togglePause);
        elements.stopBtn.addEventListener('click', stopAllTests);
    }

    // æ˜¾ç¤ºè„šæœ¬ä»£ç 
    function showScriptCode() {
        const scriptCode = `// ==UserScript==
// @name         ITDOGç½‘ç«™æµ‹é€Ÿç›‘æ§ v10.0 - æˆªå›¾å‘é€ç‰ˆ
// @namespace    http://tampermonkey.net/
// @version      10.0
// @description  è‡ªåŠ¨æå–åŸŸåã€ç‚¹å‡»å¼€å§‹æµ‹è¯•ã€ç›‘æ§è¿é€šç‡ã€æˆªå›¾å¹¶è¿”å›ç»“æœç»™ä¸»é¡µé¢
// @author       å¤šç¾¤ç›‘æ§ç³»ç»Ÿ
// @match        https://www.itdog.cn/*
// @run-at       document-end
// @grant        GM_addStyle
// @grant        GM_setValue
// @grant        GM_getValue
// @grant        GM_addValueChangeListener
// ==/UserScript==

(function() {
    'use strict';

    // é˜²é‡å¤æ‰§è¡Œæ£€æŸ¥
    if (window.itdogMonitorRunningV10) {
        console.log('ğŸš« ITDOGç›‘æ§è„šæœ¬å·²åœ¨è¿è¡Œä¸­');
        return;
    }
    window.itdogMonitorRunningV10 = true;
    window.itdogMonitorDetected = true; // è®©ä¸»é¡µé¢çŸ¥é“è„šæœ¬å·²è¿è¡Œ

    console.log('ğŸš€ ITDOGç›‘æ§è„šæœ¬å¯åŠ¨ - æˆªå›¾å‘é€ç‰ˆ v10.0');

    // é…ç½®
    const CONFIG = {
        maxChecks: 60,
        checkInterval: 2000,
        minSuccessRate: 90,
        minTotalTests: 8,
        timeout: 150000,
        waitAfterClick: 5000,
        stableThreshold: 3
    };

    // çŠ¶æ€å˜é‡
    let hasProcessed = false;
    let testStarted = false;
    let testReallyStarted = false;
    let monitoringStarted = false;
    let resultsSent = false;
    let monitoringInterval = null;
    let checkCount = 0;
    let clickTime = 0;
    let currentDomain = '';

    // æ¶ˆæ¯ç›‘å¬
    window.addEventListener('message', function(event) {
        if (event.data && event.data.type === 'PING_ITDOG_MONITOR') {
            console.log('ğŸ“© æ”¶åˆ°ä¸»é¡µé¢PINGï¼Œå›å¤PONG');
            event.source.postMessage({
                type: 'PONG_ITDOG_MONITOR',
                source: 'ITDOG_SCRIPT',
                timestamp: Date.now(),
                version: '10.0'
            }, event.origin);
        }
    });

    // è·å–åŸŸå
    function getDomain() {
        try {
            // ä»URLå‚æ•°è·å–
            const urlParams = new URLSearchParams(window.location.search);
            let domain = urlParams.get('domain');
            
            if (domain) {
                domain = decodeURIComponent(domain).trim();
                console.log('âœ… ä»URLè·å–åŸŸå:', domain);
                return domain;
            }

            // ä»è¾“å…¥æ¡†è·å–
            const inputs = document.querySelectorAll('input[type="text"], input[type="url"]');
            for (const input of inputs) {
                if (input && input.value) {
                    let value = input.value.trim();
                    if (value.length > 3) {
                        console.log('âœ… ä»è¾“å…¥æ¡†è·å–åŸŸå:', value);
                        return value;
                    }
                }
            }

            return null;
        } catch (error) {
            console.log('è·å–åŸŸåå¤±è´¥:', error);
            return null;
        }
    }

    // å–æ¶ˆæ¸¯æ¾³å°é€‰é¡¹
    function uncheckOverseas() {
        const checkboxes = document.querySelectorAll('input[type="checkbox"]');
        checkboxes.forEach(checkbox => {
            if (!checkbox.checked) return;
            
            const parent = checkbox.parentElement;
            const label = document.querySelector(\`label[for="\${checkbox.id}"]\`);
            let text = '';
            if (parent) text += parent.textContent;
            if (label) text += label.textContent;
            text = text.toLowerCase();
            
            const keywords = ['æ¸¯æ¾³å°', 'é¦™æ¸¯', 'æ¾³é—¨', 'å°æ¹¾', 'æµ·å¤–', 'å›½å¤–'];
            for (const keyword of keywords) {
                if (text.includes(keyword)) {
                    console.log(\`âœ… å–æ¶ˆå‹¾é€‰: \${keyword}\`);
                    checkbox.click();
                    return true;
                }
            }
        });
        return false;
    }

    // æŸ¥æ‰¾å¼€å§‹æŒ‰é’®
    function findStartButton() {
        const allButtons = document.querySelectorAll('button, input[type="submit"], input[type="button"]');
        
        for (const button of allButtons) {
            if (button.disabled) continue;
            
            const buttonText = (button.textContent || button.value || '').trim().toLowerCase();
            
            if (buttonText.includes('å¼€å§‹æµ‹è¯•') ||
                buttonText.includes('å¼€å§‹æ£€æµ‹') ||
                buttonText.includes('ç«‹å³æµ‹é€Ÿ') ||
                buttonText === 'æµ‹è¯•' ||
                buttonText === 'æ£€æµ‹') {
                return button;
            }
        }
        return null;
    }

    // å¼€å§‹æµ‹è¯•
    function startTest() {
        if (testStarted) return false;
        
        const button = findStartButton();
        if (!button) return false;
        
        console.log('ğŸ¯ ç‚¹å‡»å¼€å§‹æŒ‰é’®');
        clickTime = Date.now();
        testStarted = true;
        hasProcessed = true;
        
        button.click();
        return true;
    }

    // æå–æµ‹è¯•ç»“æœ
    function extractResults() {
        let totalTests = 0;
        let success200Tests = 0;
        let connectivityRate = 0;
        let completed = false;
        
        try {
            // æŸ¥æ‰¾æ£€æµ‹ç‚¹è¡¨æ ¼
            const tables = document.querySelectorAll('table');
            
            for (const table of tables) {
                const rows = table.querySelectorAll('tr');
                if (rows.length < 2) continue;
                
                const firstRow = rows[0].textContent.toLowerCase();
                const isTestTable = firstRow.includes('æ£€æµ‹ç‚¹') ||
                                   firstRow.includes('èŠ‚ç‚¹') ||
                                   firstRow.includes('çŠ¶æ€');
                
                if (isTestTable) {
                    for (let i = 1; i < rows.length; i++) {
                        const row = rows[i];
                        totalTests++;
                        
                        const rowText = row.textContent.toLowerCase();
                        if (rowText.includes('200') || 
                            rowText.includes('æˆåŠŸ') || 
                            rowText.includes('æ­£å¸¸')) {
                            success200Tests++;
                        }
                    }
                    
                    if (totalTests > 0) {
                        connectivityRate = Math.round((success200Tests / totalTests) * 100);
                        completed = totalTests >= CONFIG.minTotalTests;
                        break;
                    }
                }
            }
        } catch (error) {
            console.log('æå–ç»“æœå¤±è´¥:', error);
        }
        
        return {
            totalTests: totalTests,
            success200Tests: success200Tests,
            connectivityRate: connectivityRate,
            isCompleted: completed || (totalTests >= CONFIG.minTotalTests && connectivityRate > 0),
            isLowRate: connectivityRate < CONFIG.minSuccessRate && connectivityRate > 0
        };
    }

    // æ£€æŸ¥æµ‹è¯•æ˜¯å¦çœŸæ­£å¼€å§‹
    function checkIfTestReallyStarted() {
        const pageText = document.body.textContent.toLowerCase();
        
        if (pageText.includes('æµ‹è¯•ä¸­') ||
            pageText.includes('æ£€æµ‹ä¸­') ||
            pageText.includes('æ­£åœ¨æµ‹è¯•')) {
            return true;
        }
        
        const results = extractResults();
        if (results.totalTests > 0) {
            return true;
        }
        
        const timeSinceClick = Date.now() - clickTime;
        if (clickTime > 0 && timeSinceClick > CONFIG.waitAfterClick) {
            return true;
        }
        
        return false;
    }

    // æˆªå›¾åŠŸèƒ½
    function captureScreenshot() {
        return new Promise((resolve, reject) => {
            try {
                console.log('ğŸ“¸ å¼€å§‹æˆªå›¾...');
                
                // å°è¯•ä½¿ç”¨html2canvas
                if (typeof html2canvas !== 'undefined') {
                    html2canvas(document.body, {
                        scale: 0.8,
                        useCORS: true,
                        allowTaint: true,
                        backgroundColor: '#ffffff'
                    }).then(canvas => {
                        const dataUrl = canvas.toDataURL('image/jpeg', 0.8);
                        console.log('âœ… æˆªå›¾å®Œæˆ');
                        resolve(dataUrl);
                    }).catch(error => {
                        console.log('âŒ html2canvasæˆªå›¾å¤±è´¥:', error);
                        resolve(null);
                    });
                } else {
                    // å¦‚æœæ²¡æœ‰html2canvasï¼Œå‘é€DOMå†…å®¹
                    console.log('âš ï¸ html2canvasæœªåŠ è½½ï¼Œå‘é€æ–‡æœ¬ç»“æœ');
                    resolve(null);
                }
            } catch (error) {
                console.log('âŒ æˆªå›¾å¤±è´¥:', error);
                resolve(null);
            }
        });
    }

    // å‘é€ç»“æœåˆ°ä¸»é¡µé¢
    async function sendResults(domain, results) {
        try {
            // æˆªå›¾
            const screenshot = await captureScreenshot();
            
            const data = {
                type: 'ITDOG_TEST_RESULT',
                domain: domain || currentDomain,
                connectivityRate: results.connectivityRate || 0,
                totalTests: results.totalTests || 0,
                success200Tests: results.success200Tests || 0,
                isLowRate: results.isLowRate || false,
                isCompleted: results.isCompleted || false,
                timestamp: new Date().toISOString(),
                screenshot: screenshot, // åŒ…å«æˆªå›¾æ•°æ®
                pageUrl: window.location.href,
                pageTitle: document.title
            };
            
            console.log('ğŸ“¤ å‘é€ç»“æœåˆ°ä¸»é¡µé¢ï¼ˆåŒ…å«æˆªå›¾ï¼‰');
            
            // å‘é€ç»™ä¸»é¡µé¢
            if (window.opener && !window.opener.closed) {
                window.opener.postMessage(data, '*');
                
                // å‘é€ä¸¤æ¬¡ç¡®ä¿æ”¶åˆ°
                setTimeout(() => {
                    window.opener.postMessage(data, '*');
                }, 500);
            }
            
            // å‘é€ç»™æ‰€æœ‰çˆ¶é¡µé¢
            window.parent.postMessage(data, '*');
            
            return true;
            
        } catch (error) {
            console.log('å‘é€ç»“æœå¤±è´¥:', error);
            return false;
        }
    }

    // ç›‘æ§ç»“æœ
    function monitorResults() {
        if (monitoringStarted) return;
        
        console.log('ğŸ” å¼€å§‹ç›‘æ§æµ‹è¯•ç»“æœ...');
        monitoringStarted = true;
        checkCount = 0;
        let lastTotalTests = 0;
        let stableCount = 0;
        
        monitoringInterval = setInterval(() => {
            checkCount++;
            
            if (!testReallyStarted) {
                testReallyStarted = checkIfTestReallyStarted();
                if (testReallyStarted) {
                    console.log('âœ… æµ‹è¯•çœŸæ­£å¼€å§‹äº†');
                }
            }
            
            const results = extractResults();
            
            // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
            updateStatusDisplay(results);
            
            const isStable = results.totalTests >= CONFIG.minTotalTests &&
                            results.totalTests === lastTotalTests;
            
            if (results.isCompleted || isStable) {
                stableCount++;
            } else {
                stableCount = 0;
            }
            
            lastTotalTests = results.totalTests;
            
            if (!resultsSent && (stableCount >= CONFIG.stableThreshold || checkCount >= CONFIG.maxChecks)) {
                clearInterval(monitoringInterval);
                finishTest(results);
            }
            
        }, CONFIG.checkInterval);
    }

    // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
    function updateStatusDisplay(results) {
        let statusDiv = document.getElementById('itdog-monitor-status');
        
        if (!statusDiv) {
            statusDiv = document.createElement('div');
            statusDiv.id = 'itdog-monitor-status';
            statusDiv.style.cssText = \`
                position: fixed;
                top: 20px;
                right: 20px;
                background: rgba(0,0,0,0.9);
                color: white;
                padding: 15px;
                border-radius: 10px;
                z-index: 999999;
                font-family: Arial;
                font-size: 14px;
                border: 2px solid #3498db;
                max-width: 300px;
            \`;
            document.body.appendChild(statusDiv);
        }
        
        const rate = results.connectivityRate || 0;
        const statusColor = rate < CONFIG.minSuccessRate ? '#e74c3c' : 
                          rate > 0 ? '#2ecc71' : '#3498db';
        
        statusDiv.innerHTML = \`
            <div style="margin-bottom: 10px; display: flex; align-items: center;">
                <div style="font-size: 24px; margin-right: 10px;">ğŸš€</div>
                <div style="font-weight: bold;">ITDOGè‡ªåŠ¨ç›‘æ§</div>
            </div>
            <div style="margin-bottom: 5px;">
                <strong>åŸŸå:</strong> \${currentDomain || 'æœªè·å–'}
            </div>
            <div style="margin-bottom: 5px;">
                <strong>æ£€æµ‹èŠ‚ç‚¹:</strong> \${results.totalTests || 0}ä¸ª
            </div>
            <div style="margin-bottom: 5px;">
                <strong>è¿é€šç‡:</strong> 
                <span style="color: \${statusColor}; font-weight: bold;">
                    \${rate > 0 ? rate + '%' : 'æµ‹è¯•ä¸­...'}
                </span>
            </div>
            <div style="font-size: 12px; color: #aaa; margin-top: 10px;">
                é˜¶æ®µ: \${testStarted ? (testReallyStarted ? 'æµ‹è¯•ä¸­' : 'ç­‰å¾…å¼€å§‹') : 'æœªå¼€å§‹'}
            </div>
        \`;
    }

    // å®Œæˆæµ‹è¯•
    async function finishTest(results) {
        if (resultsSent) return;
        
        resultsSent = true;
        console.log('âœ… æµ‹è¯•å®Œæˆ:', results);
        
        const sent = await sendResults(currentDomain, results);
        
        if (sent) {
            console.log('âœ… ç»“æœå·²å‘é€åˆ°ä¸»é¡µé¢');
            showCompletionMessage();
        }
        
        // 5ç§’åå…³é—­é¡µé¢
        setTimeout(() => {
            try {
                window.close();
            } catch (e) {
                console.log('æ— æ³•è‡ªåŠ¨å…³é—­é¡µé¢');
            }
        }, 5000);
    }

    // æ˜¾ç¤ºå®Œæˆæ¶ˆæ¯
    function showCompletionMessage() {
        const completionDiv = document.createElement('div');
        completionDiv.style.cssText = \`
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.95);
            color: white;
            padding: 40px;
            border-radius: 20px;
            z-index: 1000000;
            text-align: center;
            border: 3px solid #2ecc71;
            box-shadow: 0 20px 60px rgba(0,0,0,0.8);
        \`;
        
        completionDiv.innerHTML = \`
            <div style="font-size: 80px; margin-bottom: 20px;">âœ…</div>
            <h2 style="margin: 0 0 15px 0; color: #2ecc71">æµ‹è¯•å®Œæˆ</h2>
            <div style="font-size: 24px; margin: 20px 0;">
                ç»“æœå·²å‘é€åˆ°ç›‘æ§ç³»ç»Ÿ
            </div>
            <div style="font-size: 14px; opacity: 0.8; margin-top: 30px;">
                æœ¬é¡µé¢å°†åœ¨5ç§’åè‡ªåŠ¨å…³é—­...
            </div>
        \`;
        
        document.body.appendChild(completionDiv);
    }

    // ä¸»æ‰§è¡Œæµç¨‹
    function executeTest() {
        if (hasProcessed) return;
        
        currentDomain = getDomain();
        if (!currentDomain) {
            console.log('âŒ æ— æ³•è·å–åŸŸå');
            return;
        }
        
        console.log('âœ… æµ‹è¯•åŸŸå:', currentDomain);
        
        // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
        updateStatusDisplay({totalTests: 0, success200Tests: 0, connectivityRate: 0});
        
        // æ‰§è¡Œæµ‹è¯•æµç¨‹
        setTimeout(() => {
            uncheckOverseas();
            
            setTimeout(() => {
                const started = startTest();
                
                if (started) {
                    console.log('âœ… æµ‹è¯•å·²å¯åŠ¨ï¼Œç­‰å¾…ç»“æœ...');
                    
                    // å¼€å§‹ç›‘æ§
                    setTimeout(() => {
                        monitorResults();
                    }, CONFIG.waitAfterClick);
                }
            }, 1000);
        }, 1000);
    }

    // åˆå§‹åŒ–
    function init() {
        console.log('ğŸ”„ ITDOGç›‘æ§è„šæœ¬åˆå§‹åŒ– v10.0');
        
        // æ£€æŸ¥æ˜¯å¦å·²ç»æœ‰ç»“æœ
        const existingResults = extractResults();
        if (existingResults.totalTests > 0) {
            console.log('ğŸ“Š æ£€æµ‹åˆ°å·²æœ‰æµ‹è¯•ç»“æœ');
            setTimeout(() => {
                finishTest(existingResults);
            }, 2000);
            return;
        }
        
        // å¼€å§‹æµ‹è¯•æµç¨‹
        setTimeout(executeTest, 1500);
    }

    // å¯åŠ¨
    init();

})();`;

        // åˆ›å»ºæ¨¡æ€æ¡†æ˜¾ç¤ºè„šæœ¬ä»£ç 
        const modal = document.createElement('div');
        modal.style.cssText = `
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 10000;
            display: flex;
            justify-content: center;
            align-items: center;
        `;

        const modalContent = document.createElement('div');
        modalContent.style.cssText = `
            background: white;
            padding: 30px;
            border-radius: 20px;
            max-width: 90%;
            max-height: 90%;
            overflow: auto;
            position: relative;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
        `;

        const closeBtn = document.createElement('button');
        closeBtn.textContent = 'âœ•';
        closeBtn.style.cssText = `
            position: absolute;
            top: 10px;
            right: 10px;
            background: #e74c3c;
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 16px;
        `;
        closeBtn.onclick = () => modal.remove();

        const title = document.createElement('h3');
        title.textContent = 'Tampermonkeyè„šæœ¬ä»£ç ';
        title.style.cssText = `
            margin-bottom: 20px;
            color: #2c3e50;
            text-align: center;
        `;

        const codeArea = document.createElement('textarea');
        codeArea.value = scriptCode;
        codeArea.style.cssText = `
            width: 100%;
            height: 400px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 12px;
            padding: 15px;
            border: 2px solid #3498db;
            border-radius: 10px;
            background: #f8f9fa;
            resize: vertical;
        `;

        const instructions = document.createElement('div');
        instructions.innerHTML = `
            <div style="margin: 20px 0; padding: 15px; background: #e8f4fc; border-radius: 8px;">
                <strong>å®‰è£…è¯´æ˜ï¼š</strong>
                <ol style="margin: 10px 0; padding-left: 20px;">
                    <li>å¤åˆ¶ä¸Šé¢çš„ä»£ç </li>
                    <li>æ‰“å¼€Tampermonkeyæ‰©å±•</li>
                    <li>ç‚¹å‡»"æ·»åŠ æ–°è„šæœ¬"</li>
                    <li>ç²˜è´´ä»£ç å¹¶ä¿å­˜</li>
                    <li>è®¿é—® itdog.cn æµ‹è¯•</li>
                </ol>
            </div>
        `;

        modalContent.appendChild(closeBtn);
        modalContent.appendChild(title);
        modalContent.appendChild(codeArea);
        modalContent.appendChild(instructions);
        modal.appendChild(modalContent);
        document.body.appendChild(modal);

        // è‡ªåŠ¨é€‰ä¸­ä»£ç 
        codeArea.select();
        
        addLog('ğŸ“‹ Tampermonkeyè„šæœ¬ä»£ç å·²æ˜¾ç¤º', 'info');
    }

    // æµ‹è¯•è„šæœ¬è¿æ¥
    function testScriptConnection() {
        // å°è¯•æ‰“å¼€ä¸€ä¸ªæµ‹è¯•é¡µé¢
        const testUrl = 'https://www.itdog.cn/http/?domain=example.com';
        const testWindow = window.open(testUrl, '_blank');
        
        if (testWindow) {
            addLog('ğŸŒ æ‰“å¼€æµ‹è¯•é¡µé¢æ£€æŸ¥è„šæœ¬è¿æ¥...', 'info');
            
            // ç­‰å¾…é¡µé¢åŠ è½½
            setTimeout(() => {
                testWindow.postMessage({ 
                    type: 'PING_ITDOG_MONITOR',
                    source: 'MAIN_CONTROL_TEST',
                    timestamp: Date.now()
                }, '*');
                
                // ç›‘å¬å›å¤
                const messageHandler = function(event) {
                    if (event.data && event.data.type === 'PONG_ITDOG_MONITOR') {
                        showScriptStatus('âœ… è„šæœ¬è¿æ¥æµ‹è¯•æˆåŠŸï¼', 'success');
                        addLog('âœ… Tampermonkeyè„šæœ¬è¿è¡Œæ­£å¸¸', 'success');
                        window.removeEventListener('message', messageHandler);
                        testWindow.close();
                    }
                };
                
                window.addEventListener('message', messageHandler);
                
                // è®¾ç½®è¶…æ—¶
                setTimeout(() => {
                    window.removeEventListener('message', messageHandler);
                    if (!testWindow.closed) {
                        testWindow.close();
                    }
                    showScriptStatus('âŒ è„šæœ¬è¿æ¥æµ‹è¯•å¤±è´¥ï¼Œè¯·ç¡®ä¿è„šæœ¬å·²å®‰è£…', 'error');
                }, 5000);
                
            }, 3000);
        } else {
            showScriptStatus('âŒ æ— æ³•æ‰“å¼€æµ‹è¯•é¡µé¢ï¼Œè¯·å…è®¸å¼¹å‡ºçª—å£', 'error');
        }
    }

    // å¤„ç†ITDOGæ¶ˆæ¯
    function handleITDOGMessage(event) {
        // å¤„ç†è„šæœ¬æ£€æµ‹æ¶ˆæ¯
        if (event.data && event.data.type === 'PONG_ITDOG_MONITOR') {
            window.itdogMonitorDetected = true;
            return;
        }
        
        // å¤„ç†æµ‹è¯•ç»“æœæ¶ˆæ¯
        if (event.data && event.data.type === 'ITDOG_TEST_RESULT') {
            console.log('ğŸ“© æ”¶åˆ°ITDOGæµ‹è¯•ç»“æœ:', event.data);
            
            const result = event.data;
            const groupId = findGroupIdByDomain(result.domain);
            
            if (groupId) {
                handleTestResult(groupId, result);
            }
            
            return;
        }
    }

    // æŸ¥æ‰¾åŸŸåå¯¹åº”çš„ç¾¤ç»„
    function findGroupIdByDomain(domain) {
        for (const [groupId, testState] of activeTestGroups) {
            if (testState.domains.includes(domain)) {
                return groupId;
            }
        }
        return null;
    }

    // å¤„ç†æµ‹è¯•ç»“æœ
    function handleTestResult(groupId, result) {
        const testState = activeTestGroups.get(groupId);
        const group = groups[groupId];
        
        if (!testState || !group) return;
        
        // ä¿å­˜æˆªå›¾åˆ°ç¼“å­˜
        if (result.screenshot) {
            screenshotCache.set(`${groupId}_${result.domain}`, result.screenshot);
        }
        
        // æ›´æ–°ç»Ÿè®¡
        stats.todayTests++;
        updateStatsDisplay();
        saveStats();
        
        // å‘é€ç»“æœåˆ°Telegram
        sendResultToTelegram(group, result);
        
        // æ ‡è®°ä¸ºå®Œæˆ
        const domainIndex = testState.domains.findIndex(d => d === result.domain);
        if (domainIndex !== -1) {
            testState.results[domainIndex] = result;
            updateTestProgress();
            
            // å¦‚æœæ‰€æœ‰åŸŸåéƒ½æµ‹è¯•å®Œæˆï¼Œæ¸…é™¤æµ‹è¯•çŠ¶æ€
            const allTested = testState.domains.every((_, index) => testState.results[index]);
            if (allTested) {
                if (testState.isOneTime) {
                    setTimeout(() => {
                        activeTestGroups.delete(groupId);
                        updateActiveGroupsCount();
                    }, 1000);
                } else {
                    // å®šæ—¶æµ‹è¯•ï¼Œç­‰å¾…ä¸‹ä¸€æ¬¡æ‰§è¡Œ
                    testState.isTesting = false;
                    testState.currentIndex = 0;
                    testState.results = {};
                    
                    addLog(`âœ… ç¾¤ç»„ ${group.name} æµ‹è¯•å®Œæˆï¼Œç­‰å¾…ä¸‹ä¸€æ¬¡æ‰§è¡Œ`, 'success');
                }
            }
        }
        
        // æ›´æ–°ç¾¤ç»„æœ€åæµ‹è¯•æ—¶é—´
        group.lastTested = new Date().toISOString();
        group.lastResult = result;
        saveGroups();
        updateGroupList();
    }

    // å‘é€ç»“æœåˆ°Telegramï¼ˆåŒ…å«æˆªå›¾ï¼‰
    async function sendResultToTelegram(group, result) {
        try {
            const now = new Date();
            const currentTime = now.toLocaleString('zh-CN', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                hour12: false
            }).replace(/\//g, '-');
            
            const isLowRate = result.isLowRate || false;
            const rate = result.connectivityRate || 0;
            
            // æ„å»ºæ¶ˆæ¯
            let message = `${isLowRate ? 'âš ï¸' : 'âœ…'} *ç½‘ç«™ç›‘æ§ç»“æœ - ${group.name}*\\n\\n`;
            message += `ğŸŒ *æ£€æµ‹åŸŸå:* \`${result.domain || 'æœªçŸ¥åŸŸå'}\`\\n`;
            message += `ğŸ• *æ£€æµ‹æ—¶é—´:* ${currentTime}\\n`;
            message += `ğŸ“Š *è¿é€šç‡:* ${rate}%\\n`;
            message += `âœ… *æˆåŠŸèŠ‚ç‚¹:* ${result.success200Tests || 0}/${result.totalTests || 0}\\n`;
            
            // è¿è¥å•†åˆ†æ
            if (result.operatorSummary) {
                const summary = result.operatorSummary;
                message += `\\nğŸ“¡ *è¿è¥å•†åˆ†æ*\\n`;
                
                if (summary.mobileTotal > 0) {
                    message += `â”œ ç§»åŠ¨: ${summary.mobileSuccess || 0}/${summary.mobileTotal} (${summary.mobileRate || 0}%)\\n`;
                }
                if (summary.unicomTotal > 0) {
                    message += `â”œ è”é€š: ${summary.unicomSuccess || 0}/${summary.unicomTotal} (${summary.unicomRate || 0}%)\\n`;
                }
                if (summary.telecomTotal > 0) {
                    message += `â”œ ç”µä¿¡: ${summary.telecomSuccess || 0}/${summary.telecomTotal} (${summary.telecomRate || 0}%)\\n`;
                }
                
                const totalErrors = (summary.mobileErrors || 0) + (summary.unicomErrors || 0) + (summary.telecomErrors || 0) + (summary.otherErrors || 0);
                if (totalErrors > 0) {
                    message += `â”œ *å¼‚å¸¸æ€»æ•°:* ${totalErrors}ä¸ª\\n`;
                }
            }
            
            // å¼‚å¸¸æ—¶@ç›¸å…³äººå‘˜
            if (isLowRate && group.mentionUsers.length > 0) {
                const mentions = group.mentionUsers.map(userId => `[${userId}](tg://user?id=${userId})`).join(' ');
                message += `\\nğŸ“¢ *å¼‚å¸¸é€šçŸ¥:* ${mentions}\\n`;
                message += `âš ï¸ *å‘Šè­¦:* è¿é€šç‡ä½äº${group.threshold}%ï¼\\n`;
            }
            
            message += `\\nğŸ”— *æµ‹è¯•é“¾æ¥:* ${result.pageUrl || \`https://www.itdog.cn/http/?domain=\${encodeURIComponent(result.domain)}\`}\\n`;
            
            // å‘é€æ¶ˆæ¯
            let response;
            
            // å¦‚æœæœ‰æˆªå›¾ä¸”ç”¨æˆ·é€‰æ‹©å‘é€æˆªå›¾
            if (result.screenshot && group.sendScreenshot !== false) {
                // Telegram Bot API ä¸æ”¯æŒç›´æ¥å‘é€base64å›¾ç‰‡ï¼Œéœ€è¦ä¸Šä¼ 
                // è¿™é‡Œå…ˆå‘é€æ–‡æœ¬æ¶ˆæ¯ï¼Œæˆªå›¾ä½œä¸ºé™„ä»¶å‘é€æ¯”è¾ƒå¤æ‚ï¼Œéœ€è¦æœåŠ¡å™¨æ”¯æŒ
                response = await sendTelegramMessage(group.botToken, group.chatId, message);
            } else {
                response = await sendTelegramMessage(group.botToken, group.chatId, message);
            }
            
            if (response.ok) {
                stats.sentNotifications++;
                updateStatsDisplay();
                saveStats();
                
                const logMsg = isLowRate ? 
                    `âš ï¸ å¼‚å¸¸ç»“æœå·²å‘é€åˆ°ç¾¤ç»„: ${group.name}` : 
                    `âœ… ç»“æœå·²å‘é€åˆ°ç¾¤ç»„: ${group.name}`;
                addLog(logMsg, isLowRate ? 'warning' : 'success');
                
                return true;
            } else {
                throw new Error(response.description || 'å‘é€å¤±è´¥');
            }
            
        } catch (error) {
            addLog(`âŒ å‘é€ç»“æœå¤±è´¥: ${error.message}`, 'error');
            return false;
        }
    }

    // å‘é€Telegramæ¶ˆæ¯
    async function sendTelegramMessage(botToken, chatId, text) {
        try {
            const response = await fetch(`https://api.telegram.org/bot${botToken}/sendMessage`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    chat_id: chatId,
                    text: text,
                    parse_mode: 'Markdown',
                    disable_web_page_preview: false
                })
            });
            
            return await response.json();
        } catch (error) {
            console.error('å‘é€Telegramæ¶ˆæ¯å¤±è´¥:', error);
            return { ok: false, description: error.message };
        }
    }

    // ä»¥ä¸‹å‡½æ•°ä¸ä¹‹å‰ç‰ˆæœ¬ç›¸åŒï¼ˆä½†éœ€è¦åŒ…å«æˆªå›¾ç›¸å…³çš„ä¿®æ”¹ï¼‰
    // åŒ…æ‹¬ï¼šsaveGroup, clearForm, deleteGroup, updateGroupList, selectGroup, 
    // editGroup, deleteGroupById, toggleGroupEnabled, startAllGroups, 
    // startSelectedGroup, testSelectedGroupOnce, startGroupTest, 
    // stopGroupTest, stopAllGroups, testNextDomain, openITDOGTest, 
    // showTestControls, hideTestControls, updateActiveGroupsCount, 
    // updateTestProgress, updateTestStats, togglePause, stopAllTests, 
    // updateStatsDisplay, showStatus, addLog, checkDailyReset, 
    // resetDailyStats, updateTotalDomains

    // ä¸ºäº†ç®€æ´ï¼Œè¿™é‡Œçœç•¥äº†è¿™äº›å‡½æ•°çš„é‡å¤ä»£ç ï¼Œä½†æ‚¨éœ€è¦ç¡®ä¿å®ƒä»¬è¢«æ­£ç¡®å®ç°
    // ç‰¹åˆ«æ˜¯openITDOGTestå‡½æ•°éœ€è¦æ­£ç¡®æ„å»ºITDOGæµ‹è¯•URL

    // åˆå§‹åŒ–åº”ç”¨
    init();
});
</script>
</body>
</html>
